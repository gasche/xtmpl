<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Xtmpl" rel="Chapter" href="Xtmpl.html"><link title="Environment" rel="Section" href="#2_Environment">
<link title="XML Manipulation" rel="Section" href="#2_XMLManipulation">
<link title="Templating engine" rel="Section" href="#engine">
<link title="Utilities" rel="Section" href="#2_Utilities">
<title>Xtmpl : Xtmpl</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;</div>
<h1>Module <a href="type_Xtmpl.html">Xtmpl</a></h1>

<pre><span class="keyword">module</span> Xtmpl: <code class="code">sig</code> <a href="Xtmpl.html">..</a> <code class="code">end</code></pre><div class="info module top">
Xml templating library.
<p>

    Rewrite XML <a href="Xtmpl.html#TYPEtree"><code class="code">Xtmpl.tree</code></a>s using <a href="Xtmpl.html#TYPEcallback"><code class="code">Xtmpl.callback</code></a> rules
    provided by the <a href="Xtmpl.html#TYPEenv"><code class="code">Xtmpl.env</code></a> environment.
<p>

    A complete description of the templating rules is available in the
    <a href="Xtmpl.html#engine"><i>Templating engine</i></a> section below.<br>
</div>
<hr width="100%">

<pre><span id="EXCEPTIONNo_change"><span class="keyword">exception</span> No_change</span></pre>
<div class="info ">
This exception can be raised by callbacks to indicate that the
  node to be rewritten remains unchanged.<br>
</div>

<pre><span id="TYPEname"><span class="keyword">type</span> <code class="type"></code>name</span> = <code class="type">string * string</code> </pre>


<pre><span id="TYPEattribute"><span class="keyword">type</span> <code class="type"></code>attribute</span> = <code class="type"><a href="Xtmpl.html#TYPEname">name</a> * string</code> </pre>


<pre><span id="TYPEenv"><span class="keyword">type</span> <code class="type"></code>env</span> </pre>


<pre><span id="TYPEcallback"><span class="keyword">type</span> <code class="type"></code>callback</span> = <code class="type"><a href="Xtmpl.html#TYPEenv">env</a> -> <a href="Xtmpl.html#TYPEattribute">attribute</a> list -> <a href="Xtmpl.html#TYPEtree">tree</a> list -> <a href="Xtmpl.html#TYPEtree">tree</a> list</code> </pre>


<pre><code><span id="TYPEtree"><span class="keyword">type</span> <code class="type"></code>tree</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.E"><span class="constructor">E</span></span> <span class="keyword">of</span> <code class="type"><a href="Xtmpl.html#TYPEname">name</a> * <a href="Xtmpl.html#TYPEattribute">attribute</a> list * <a href="Xtmpl.html#TYPEtree">tree</a> list</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.D"><span class="constructor">D</span></span> <span class="keyword">of</span> <code class="type">string</code></code></td>

</tr></table>


<br>
<h2 id="2_Environment">Environment</h2>
<p>

    An <a href="Xtmpl.html#TYPEenv"><code class="code">Xtmpl.env</code></a> is a <a href="Xtmpl.html#TYPEname"><code class="code">Xtmpl.name</code></a>-to-<a href="Xtmpl.html#TYPEcallback"><code class="code">Xtmpl.callback</code></a> associative map. In addition
    to basic manipulation functions, the functions <a href="Xtmpl.html#VALenv_add_att"><code class="code">Xtmpl.env_add_att</code></a> and
    <a href="Xtmpl.html#VALenv_of_list"><code class="code">Xtmpl.env_of_list</code></a> provide convenient shortcuts for common operations.
<p>

    The environments are immutable, all mutating operations return new
    environments.<br>

<pre><span id="VALenv_empty"><span class="keyword">val</span> env_empty</span> : <code class="type"><a href="Xtmpl.html#TYPEenv">env</a></code></pre><div class="info ">
An environment that contains only one binding, associating
  <a href="Xtmpl.html#VALtag_main"><code class="code">Xtmpl.tag_main</code></a> to a function returning its subnodes.<br>
</div>

<pre><span id="VALenv_add"><span class="keyword">val</span> env_add</span> : <code class="type">?prefix:string -> string -> <a href="Xtmpl.html#TYPEcallback">callback</a> -> <a href="Xtmpl.html#TYPEenv">env</a> -> <a href="Xtmpl.html#TYPEenv">env</a></code></pre><div class="info ">
Add a binding to an environment.
<p>

    <code class="code">env_add "double" (fun _ _ xml -&gt; xml @ xml)</code> binds the key
    <code class="code">("", "double")</code> to a callback that doubles an XML subtree.
<p>

    <code class="code">env_add ~prefix: "foo" "double" (fun _ _ xml -&gt; xml @ xml)</code> does the same but
    for the key  <code class="code">("foo", "double")</code>.
<p>

    If the same key was already bound, the previous binding is
    replaced.<br>
</div>
<div class="param_info"><code class="code">prefix</code> : is <code class="code">""</code> by default.</div>

<pre><span id="VALenv_get"><span class="keyword">val</span> env_get</span> : <code class="type"><a href="Xtmpl.html#TYPEname">name</a> -> <a href="Xtmpl.html#TYPEenv">env</a> -> <a href="Xtmpl.html#TYPEcallback">callback</a> option</code></pre><div class="info ">
Get a binding from an environment.
<p>

    If the binding is not found, returns <code class="code">None</code>.<br>
</div>

<pre><span id="VALstring_of_env"><span class="keyword">val</span> string_of_env</span> : <code class="type"><a href="Xtmpl.html#TYPEenv">env</a> -> string</code></pre><div class="info ">
String representation of all the keys in the environment.<br>
</div>

<pre><span id="VALenv_add_att"><span class="keyword">val</span> env_add_att</span> : <code class="type">?prefix:string -> string -> string -> <a href="Xtmpl.html#TYPEenv">env</a> -> <a href="Xtmpl.html#TYPEenv">env</a></code></pre><div class="info ">
Bind a callback that returns some XML.
<p>

    The most frequent operation performed by a callback is to return a
    constant XML subtree. This convenience function lets you provide
    the XML subtree as a string.
<p>

    <code class="code">env_add_att "logo" "&lt;img src=\"logo.png\"/&gt;" env</code> binds the key
    <code class="code">("","logo")</code> to a callback that returns an XHTML image tag.
<p>

    Note that the provided XML is automatically wrapped in the
    <a href="Xtmpl.html#VALtag_main"><code class="code">Xtmpl.tag_main</code></a> tag, which will cause the corresponding
    templating rules to be applied to it<br>
</div>

<pre><span id="VALenv_of_list"><span class="keyword">val</span> env_of_list</span> : <code class="type">?env:<a href="Xtmpl.html#TYPEenv">env</a> -> (<a href="Xtmpl.html#TYPEname">name</a> * <a href="Xtmpl.html#TYPEcallback">callback</a>) list -> <a href="Xtmpl.html#TYPEenv">env</a></code></pre><div class="info ">
Add several bindings at once.
<p>

    This convenience function saves you the effort of calling
    <a href="Xtmpl.html#VALenv_add"><code class="code">Xtmpl.env_add</code></a> several times yourself.
<p>

    <code class="code">env_of_list ~env:env [ (ns1, k1), f1 ; (ns2, k2), f2 ]</code> is equivalent to
    <code class="code">env_add ~prefix: ns1 k1 f1 (env_add ~prefix: ns2 k2 f2 env)</code>. This means that one key
    is present twice in the list, the first association in the list
    will hide the second one in the resulting environment.<br>
</div>
<div class="param_info"><code class="code">env</code> : The environment to which bindings are added. If
    not provided, <a href="Xtmpl.html#VALenv_empty"><code class="code">Xtmpl.env_empty</code></a> is used.</div>
<br>
<h2 id="2_XMLManipulation">XML Manipulation</h2><br>

<pre><span id="VALtag_main"><span class="keyword">val</span> tag_main</span> : <code class="type">string</code></pre><div class="info ">
A dummy tag, currently <code class="code">"main_"</code>. It is used when parsing a
   string as an XML tree, to ensure that we will parse a tree and
   not a list of trees. For this purpose, the tag is used to enclosed
   a string before parsing it.
<p>

    Used by <a href="Xtmpl.html#VALenv_add_att"><code class="code">Xtmpl.env_add_att</code></a>, <a href="Xtmpl.html#VALxml_of_string"><code class="code">Xtmpl.xml_of_string</code></a> and, most importantly,
    by the <code class="code">apply_*</code> functions.<br>
</div>

<pre><span id="VALtag_env"><span class="keyword">val</span> tag_env</span> : <code class="type">string</code></pre><div class="info ">
The environment tag, currently <code class="code">"env_"</code>.
<p>

    See the template rules in the templating engine section below for more
    information about this tag.<br>
</div>

<pre><span id="VALstring_of_xml"><span class="keyword">val</span> string_of_xml</span> : <code class="type"><a href="Xtmpl.html#TYPEtree">tree</a> -> string</code></pre><div class="info ">
Output an XML string.
<p>

    The returned string does not include the initial <code class="code">&lt;?xml ... ?&gt;</code>.<br>
</div>

<pre><span id="VALstring_of_xmls"><span class="keyword">val</span> string_of_xmls</span> : <code class="type"><a href="Xtmpl.html#TYPEtree">tree</a> list -> string</code></pre><div class="info ">
Use <a href="Xtmpl.html#VALstring_of_xml"><code class="code">Xtmpl.string_of_xml</code></a> to concatenate a list of xml trees into one string,
  with no separator.<br>
</div>

<pre><span id="VALxml_of_string"><span class="keyword">val</span> xml_of_string</span> : <code class="type">?add_main:bool -> string -> <a href="Xtmpl.html#TYPEtree">tree</a></code></pre><div class="info ">
Parses a string as XML.<br>
<b>Raises</b> <code>Failure</code> when a parsing error occurs, includes the source string.<br>
</div>
<div class="param_info"><code class="code">add_main</code> : if true, adds <code class="code">&lt;main_&gt;..&lt;/main_&gt;</code> around the string
    (see <a href="Xtmpl.html#VALtag_main"><code class="code">Xtmpl.tag_main</code></a>).</div>

<pre><span id="VALxml_of_file"><span class="keyword">val</span> xml_of_file</span> : <code class="type">string -> <a href="Xtmpl.html#TYPEtree">tree</a></code></pre><div class="info ">
Same as <a href="Xtmpl.html#VALxml_of_string"><code class="code">Xtmpl.xml_of_string</code></a> but read from a file.<br>
</div>
<br>
<h2 id="engine">Templating engine</h2>
<p>

    The <code class="code">apply_*</code> functions apply a given environment to XML tree(s). These
    trees are given as parameter (<a href="Xtmpl.html#VALapply_to_xmls"><code class="code">Xtmpl.apply_to_xmls</code></a>) or can be read from a
    file (<a href="Xtmpl.html#VALapply_to_file"><code class="code">Xtmpl.apply_to_file</code></a>), or a string (<a href="Xtmpl.html#VALapply_to_string"><code class="code">Xtmpl.apply_to_string</code></a>).
<p>

    The functions return the result of the rewrite as XML trees, or
    can write it to a file (<a href="Xtmpl.html#VALapply_into_file"><code class="code">Xtmpl.apply_into_file</code></a>).
<p>

    The rewrite rules are applied until a fix-point is reached.
<p>

    <b>I.</b> A single iteration descends recursively into the XML tree. If an
    element has a callback associated in the environment, then the
    callback is applied to the node's attributes and children.
<p>

    <i>Example</i>: consider the following XML:
<p>

    <pre class="verbatim">&lt;album author="Rammstein" name="Reise, Reise"&gt;
  &lt;track&gt;Los&lt;/track&gt;
  &lt;track&gt;Mein Teil&lt;/track&gt;
&lt;/album&gt;</pre>
<p>

    This would look for a callback bound to <code class="code">("","album")</code> in the environment
    and call it using <code class="code">callback env [("","author"),"Rammstein"; ("","name"),"Reise, Reise"] xml</code>
    where <code class="code">env</code> is the current environment and <code class="code">xml</code> represents the
    two children <code class="code"> &lt;track&gt;..&lt;/track&gt; </code> elements.
<p>

    <b>II.</b> The callback returns a new list of elements that is used
    instead of the old element.
<p>

    <i>Example</i>: assuming that <code class="code">env_add "x2" (fun _ _ xml -&gt; xml @ xml)</code>,
    then <code class="code">&lt;x2&gt;A&lt;/x2&gt;</code> is rewritten as <code class="code">AA</code>.
<p>

    <b>III.</b> The engine then recursively descends into those replaced
    elements (this means that a poorly conceived rule set may well never
    terminate).
<p>

    <i>Example</i>: <code class="code">&lt;x2&gt;&lt;x2&gt;A&lt;/x2&gt;&lt;/x2&gt;</code> is first rewritten as
    <code class="code">&lt;x2&gt;A&lt;/x2&gt;&lt;x2&gt;A&lt;/x2&gt;</code>, and then as <code class="code">AAAA</code>.
<p>

    <b>IV.</b> The <code class="code">env_</code> and <code class="code">main_</code> elements (see <a href="Xtmpl.html#VALtag_env"><code class="code">Xtmpl.tag_env</code></a>
    and <a href="Xtmpl.html#VALtag_main"><code class="code">Xtmpl.tag_main</code></a>) are a special case: both are automatically
    replaced with their children (as if their callback was
    <code class="code">(fun _ _ xml -&gt; xml)</code>).
<p>

    <code class="code">env_</code> effectively changes the environment
    used when processing its children by adding the bindings defined by
    its arguments (using <a href="Xtmpl.html#VALenv_add_att"><code class="code">Xtmpl.env_add_att</code></a>, hence the name).
<p>

    <i>Example</i>: <code class="code">&lt;env_ a="&amp;lt;b&amp;gt;A&amp;lt;/b&amp;gt;"&gt;&lt;a/&gt;&lt;/env_&gt;</code> is
    replaced by <code class="code">&lt;a/&gt;</code>, which in turn is replaced by
    <code class="code">&lt;b&gt;A&lt;/b&gt;</code>.
<p>

    <b>V.</b> If an element has a <code class="code">defer_</code> attribute (that is greater
    than zero), then it is not processed and the attribute is decremented
    by one, and the process recursively applies to its children.
<p>

    <i>Example</i>: <code class="code">&lt;x2 defer_="1"&gt;&lt;x2&gt;A&lt;/x2&gt;&lt;/x2&gt;</code> is rewritten as
    <code class="code">&lt;x2 defer_="0"&gt;AA&lt;/x2&gt;</code>. The <b>next</b> iteration will effectively apply the
    rule to the node and return <code class="code">AAAA</code>.<br>

<pre><span id="VALapply_to_string"><span class="keyword">val</span> apply_to_string</span> : <code class="type"><a href="Xtmpl.html#TYPEenv">env</a> -> string -> <a href="Xtmpl.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Applies as many iterations as necessary to a piece of XML (represented
    as an unparsed string) to reach a fix-point.
<p>

    See above for how an iteration is applied.<br>
</div>

<pre><span id="VALapply_to_file"><span class="keyword">val</span> apply_to_file</span> : <code class="type"><a href="Xtmpl.html#TYPEenv">env</a> -> string -> <a href="Xtmpl.html#TYPEtree">tree</a> list</code></pre><div class="info ">
As <a href="Xtmpl.html#VALapply_to_string"><code class="code">Xtmpl.apply_to_string</code></a>, but reads the XML from a file.<br>
</div>

<pre><span id="VALapply_to_xmls"><span class="keyword">val</span> apply_to_xmls</span> : <code class="type"><a href="Xtmpl.html#TYPEenv">env</a> -> <a href="Xtmpl.html#TYPEtree">tree</a> list -> <a href="Xtmpl.html#TYPEtree">tree</a> list</code></pre><div class="info ">
As <a href="Xtmpl.html#VALapply_to_string"><code class="code">Xtmpl.apply_to_string</code></a>, but applies to a list of XML trees.<br>
</div>

<pre><span id="VALapply_into_file"><span class="keyword">val</span> apply_into_file</span> : <code class="type">?head:string -> <a href="Xtmpl.html#TYPEenv">env</a> -> infile:string -> outfile:string -> unit</code></pre><div class="info ">
As <a href="Xtmpl.html#VALapply_to_file"><code class="code">Xtmpl.apply_to_file</code></a>, but writes the result back to a file.
<p>

    For instance, <code class="code">apply_to_file env ~infile:"source.xml" ~outfile: "dest.xml"</code>.<br>
</div>
<div class="param_info"><code class="code">head</code> : Prepend this string to the XML that is output
    to the file. By default, nothing is prepended.</div>

<pre><span id="VALapply_string_into_file"><span class="keyword">val</span> apply_string_into_file</span> : <code class="type">?head:string -> <a href="Xtmpl.html#TYPEenv">env</a> -> outfile:string -> string -> unit</code></pre><div class="info ">
As <a href="Xtmpl.html#VALapply_into_file"><code class="code">Xtmpl.apply_into_file</code></a>, but read the XML from a string instead of a file.<br>
</div>
<br>
<h2 id="2_Utilities">Utilities</h2>
<p>

    Several useful functions when workin with XML.<br>

<pre><span id="VALget_arg"><span class="keyword">val</span> get_arg</span> : <code class="type"><a href="Xtmpl.html#TYPEattribute">attribute</a> list -> <a href="Xtmpl.html#TYPEname">name</a> -> string option</code></pre><div class="info ">
Finds a binding in an attribute list.
<p>

    This performs the same as <code class="code">List.assoc</code>, but returns an optional string
    instead of raising <code class="code">Not_found</code>.<br>
</div>

<pre><span id="VALstring_of_args"><span class="keyword">val</span> string_of_args</span> : <code class="type"><a href="Xtmpl.html#TYPEattribute">attribute</a> list -> string</code></pre><div class="info ">
A string representation of an argument list.
<p>

    <code class="code">string_of_args ["a","x";"b","y"]</code> returns <code class="code">a="x" b="y"</code>. Note that
    the argument names are output verbatim, but the argument values are
    escaped with the <code class="code">%S</code> format.<br>
</div>

<pre><span id="VALopt_arg"><span class="keyword">val</span> opt_arg</span> : <code class="type"><a href="Xtmpl.html#TYPEattribute">attribute</a> list -> ?def:string -> <a href="Xtmpl.html#TYPEname">name</a> -> string</code></pre><div class="info ">
Finds a binding in an associative list, or returns a default.
<p>

    This performs the same as <code class="code">List.assoc</code>, but returns the provided
    default value instead of raising <code class="code">Not_found</code>.<br>
</div>
<div class="param_info"><code class="code">def</code> : Default value, returned for missing bindings. If not
    provided, an empty string is used.</div>
</body></html>