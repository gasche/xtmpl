<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<ocamldoc with-contents="true">
<title>Xtmpl reference documentation : Xtmpl_rewrite</title><contents><div class="ocamldoc-page">
<div class="navbar"><a class="pre" href="Xtmpl_misc.html" title="Xtmpl_misc">Previous</a>
&#160;<a class="up" href="index.html" title="Index">Up</a>
&#160;<a class="post" href="Xtmpl_xhtml.html" title="Xtmpl_xhtml">Next</a>
</div>
<h1>Module <a href="type_Xtmpl_rewrite.html">Xtmpl_rewrite</a></h1>

<pre><span class="keyword">module</span> Xtmpl_rewrite: <code class="code">sig</code> <a href="Xtmpl_rewrite.html">..</a> <code class="code">end</code></pre><div class="info module top">
Rewriting XML trees.
<div class="vertical-space"> </div>

    Rewrite XML <a href="Xtmpl_rewrite.html#TYPEtree"><code class="code">Xtmpl_rewrite.tree</code></a>s using <a href="Xtmpl_rewrite.html#TYPEcallback"><code class="code">Xtmpl_rewrite.callback</code></a> rules
    provided by the <a href="Xtmpl_rewrite.html#TYPEenv"><code class="code">Xtmpl_rewrite.env</code></a> environment.
<div class="vertical-space"> </div>

    A complete description of the templating rules is available in the
    <a href="Xtmpl_rewrite.html#engine"><i>Templating engine</i></a> section below.<br/>
</div>
<hr width="100%"/>

<pre><span class="keyword">module</span> <a href="Xtmpl_rewrite.Xml.html">Xml</a>: <code class="type"><a href="Xtmpl_xml.html">Xtmpl_xml</a></code></pre><br/>
<div class="section-title" id="2_XMLtrees">XML trees</div><br/>

<pre><span id="TYPEname"><span class="keyword">type</span> name</span> = <code class="type">string * string</code> </pre>


<pre><span id="TYPEattributes"><span class="keyword">type</span> attributes</span> = <code class="type"><a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list Xml.attributes</code> </pre>
<div class="info ">
Attributes of a XML node in a rewrite tree.
       Note that the content value of an attribute is
       a list of XML trees, not just a string.<br/>
</div>


<pre><code><span id="TYPEnode"><span class="keyword">type</span> node</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTnode.loc">loc</span>&#160;: <code class="type">Xml.loc option</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTnode.name">name</span>&#160;: <code class="type"><a href="Xtmpl_rewrite.html#TYPEname">name</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTnode.atts">atts</span>&#160;: <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&#160;&#160;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTnode.subs">subs</span>&#160;: <code class="type"><a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code>;</code></td>

</tr></table>
}



<pre><code><span id="TYPEtree"><span class="keyword">type</span> tree</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.E"><span class="constructor">E</span></span> <span class="keyword">of</span> <code class="type"><a href="Xtmpl_rewrite.html#TYPEnode">node</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
XML element<br/>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.D"><span class="constructor">D</span></span> <span class="keyword">of</span> <code class="type">Xml.cdata</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
CDATA<br/>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.C"><span class="constructor">C</span></span> <span class="keyword">of</span> <code class="type">Xml.comment</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Comment<br/>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtree.PI"><span class="constructor">PI</span></span> <span class="keyword">of</span> <code class="type">Xml.proc_inst</code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
Processing instruction<br/>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr></table>


<br/>
<div class="section-title" id="2_Constructors">Constructors</div><br/>

<pre><span id="VALnode"><span class="keyword">val</span> node</span> : <code class="type">?loc:Xml.loc -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt;<br/>       ?atts:<a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre>
<pre><span id="VALcdata"><span class="keyword">val</span> cdata</span> : <code class="type">?loc:Xml.loc -&gt; ?quoted:bool -&gt; string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre>
<pre><span id="VALcomment"><span class="keyword">val</span> comment</span> : <code class="type">?loc:Xml.loc -&gt; string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre>
<pre><span id="VALpi"><span class="keyword">val</span> pi</span> : <code class="type">?loc:Xml.loc -&gt; <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre>
<pre><span id="VALdoc"><span class="keyword">val</span> doc</span> : <code class="type">Xml.prolog -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc</code></pre>
<pre><span id="VALupto_first_element"><span class="keyword">val</span> upto_first_element</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
<code class="code">upto_first_element trees</code> returns the list of trees until
  the first <code class="code">E</code> element, included.<br/>
<b>Raises</b> <code>Not_found</code> if there is no element in the list.<br/>
</div>
<br/>
<div class="section-title" id="attributes">Attributes</div><br/>

<pre><span id="VALatts_empty"><span class="keyword">val</span> atts_empty</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre><div class="info ">
Empty <a href="Xtmpl_rewrite.html#TYPEattributes"><code class="code">Xtmpl_rewrite.attributes</code></a> structure.<br/>
</div>

<pre><span id="VALatts_of_list"><span class="keyword">val</span> atts_of_list</span> : <code class="type">?atts:<a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       (<a href="Xtmpl_rewrite.html#TYPEname">name</a> * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list) list -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre><div class="info ">
<code class="code">atts_of_list list</code> returns an <a href="Xtmpl_rewrite.html#TYPEattributes"><code class="code">Xtmpl_rewrite.attributes</code></a> structure from the given
  list of pairs <code class="code">(name, xml tree list) ; (name, xml tree list) ; ...</code>.<br/>
</div>
<div class="param_info"><code class="code">atts</code> : can be used to specify an existing <a href="Xtmpl_rewrite.html#TYPEattributes"><code class="code">Xtmpl_rewrite.attributes</code></a> structure to
  add bindings to, instead of starting from an empty one.</div>

<pre><span id="VALatts_one"><span class="keyword">val</span> atts_one</span> : <code class="type">?atts:<a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre><div class="info ">
<code class="code">atts_one ?atts name xmls</code> is like <a href="Xtmpl_rewrite.html#VALatts_of_list"><code class="code">Xtmpl_rewrite.atts_of_list</code></a> but for one attribute.<br/>
</div>

<pre><span id="VALatts_remove"><span class="keyword">val</span> atts_remove</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre><div class="info ">
<code class="code">atts_remove name attributes</code> removes the binding to <code class="code">name</code> from the
  <code class="code">attributes</code>.<br/>
</div>

<pre><span id="VALatts_replace"><span class="keyword">val</span> atts_replace</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre><div class="info ">
<code class="code">atts_replace name xmls attributes</code> adds a new bindings from <code class="code">name</code> to
  <code class="code">xmls</code> in <code class="code">attributes</code>. If <code class="code">name</code> was previously bound, the previous
  binding is removed.<br/>
</div>

<pre><span id="VALget_att"><span class="keyword">val</span> get_att</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list option</code></pre><div class="info ">
<code class="code">get_att attributes name</code> returns the xml tree list bound to <code class="code">name</code> in
  <code class="code">attributes</code>. Return <code class="code">None</code> if no binding was found for <code class="code">name</code>.<br/>
</div>

<pre><span id="VALget_att_cdata"><span class="keyword">val</span> get_att_cdata</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; string option</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALget_att"><code class="code">Xtmpl_rewrite.get_att</code></a> but return a string <code class="code">s</code> only if <code class="code">name</code> is bound to
  a single CDATA XML node (<code class="code">[D s]</code>).
  In particular, if <code class="code">name</code> is bound to a list of XML tree, or to
  a single tree which is not a CDATA, the function returns <code class="code">None</code>.<br/>
</div>

<pre><span id="VALopt_att"><span class="keyword">val</span> opt_att</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       ?def:<a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
<code class="code">opt_att attributes ?def name</code> returns the tree list associated to <code class="code">name</code>
  in the <code class="code">attributes</code> or a default value. This default value can be
  specified with the <code class="code">def</code> parameter. If no default value is specified, then
  the empty list is used.<br/>
</div>

<pre><span id="VALopt_att_cdata"><span class="keyword">val</span> opt_att_cdata</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt; ?def:string -&gt; <a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt; string</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALopt_att"><code class="code">Xtmpl_rewrite.opt_att</code></a> but looking for CDATA bounded values, as in
  <a href="Xtmpl_rewrite.html#VALget_att_cdata"><code class="code">Xtmpl_rewrite.get_att_cdata</code></a>.<br/>
</div>
<br/>
<div class="section-title" id="2_Environment">Environment</div>
<div class="vertical-space"> </div>

    An <a href="Xtmpl_rewrite.html#TYPEenv"><code class="code">Xtmpl_rewrite.env</code></a> is a <a href="Xtmpl_rewrite.html#TYPEname"><code class="code">Xtmpl_rewrite.name</code></a>-to-<a href="Xtmpl_rewrite.html#TYPEcallback"><code class="code">Xtmpl_rewrite.callback</code></a> associative map. In addition
    to basic manipulation functions, the functions <a href="Xtmpl_rewrite.html#VALenv_add_xml"><code class="code">Xtmpl_rewrite.env_add_xml</code></a> and
    <a href="Xtmpl_rewrite.html#VALenv_of_list"><code class="code">Xtmpl_rewrite.env_of_list</code></a> provide convenient shortcuts for common operations.
<div class="vertical-space"> </div>

    The environments are immutable, all mutating operations return new
    environments.<br/>

<pre><span id="TYPEenv"><span class="keyword">type</span> <code class="type">'a</code> env</span> = <code class="type">'a <a href="Xtmpl_rewrite.html#TYPEcallback">callback</a> Xml.Name_map.t</code> </pre>


<pre><span id="TYPEcallback"><span class="keyword">type</span> <code class="type">'a</code> callback</span> = <code class="type">'a -&gt;<br/>       'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt;<br/>       ?loc:Xml.loc -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; 'a * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code> </pre>


<pre><span id="EXCEPTIONNo_change"><span class="keyword">exception</span> No_change</span></pre>
<div class="info ">
This exception can be raised by callbacks to indicate that the
  node to be rewritten remains unchanged.<br/>
</div>

<pre><span id="VALenv_empty"><span class="keyword">val</span> env_empty</span> : <code class="type">unit -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a></code></pre><div class="info ">
An environment that contains no binding.<br/>
</div>

<pre><span id="VALenv_add_cb"><span class="keyword">val</span> env_add_cb</span> : <code class="type">?prefix:string -&gt;<br/>       string -&gt;<br/>       'a <a href="Xtmpl_rewrite.html#TYPEcallback">callback</a> -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a></code></pre><div class="info ">
Add a binding to an environment.
<div class="vertical-space"> </div>

    <code class="code">env_add_cb "double" (fun acc _ _ xml -&gt; (acc, xml @ xml))</code> binds the key
    <code class="code">("", "double")</code> to a callback that doubles an XML subtree.
<div class="vertical-space"> </div>

    <code class="code">env_add_cb ~prefix: "foo" "double" (fun acc _ _ xml -&gt; (acc, xml @ xml))</code> does the same but
    for the key  <code class="code">("foo", "double")</code>.
<div class="vertical-space"> </div>

    If the same key was already bound, the previous binding is replaced.<br/>
</div>
<div class="param_info"><code class="code">prefix</code> : is <code class="code">""</code> by default.</div>

<pre><span id="VALenv_add_xml"><span class="keyword">val</span> env_add_xml</span> : <code class="type">?prefix:string -&gt;<br/>       string -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a></code></pre><div class="info ">
Bind a callback that returns some XML.
<div class="vertical-space"> </div>

    The most frequent operation performed by a callback is to return
    constant XML subtrees. This convenience function lets you provide
    the XML subtrees.
<div class="vertical-space"> </div>

    <code class="code">env_add_xml "logo" [ E (("","img"), atts_one ("","src") [D "logo.png"], []) ] env</code>
    binds the key <code class="code">("","logo")</code> to a callback that returns an XHTML image tag.<br/>
</div>
<div class="param_info"><code class="code">prefix</code> : can be used to specify a prefix for the rule name. Default is <code class="code">""</code>.</div>

<pre><span id="VALenv_get"><span class="keyword">val</span> env_get</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEname">name</a> -&gt;<br/>       'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEcallback">callback</a> option</code></pre><div class="info ">
Get a binding from an environment.
<div class="vertical-space"> </div>

    If the binding is not found, returns <code class="code">None</code>.<br/>
</div>

<pre><span id="VALstring_of_env"><span class="keyword">val</span> string_of_env</span> : <code class="type">'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; string</code></pre><div class="info ">
String representation of all the keys in the environment.<br/>
</div>

<pre><span id="VALenv_of_list"><span class="keyword">val</span> env_of_list</span> : <code class="type">?env:'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt;<br/>       (<a href="Xtmpl_rewrite.html#TYPEname">name</a> * 'a <a href="Xtmpl_rewrite.html#TYPEcallback">callback</a>) list -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a></code></pre><div class="info ">
Add several bindings at once.
<div class="vertical-space"> </div>

    This convenience function saves you the effort of calling
    <a href="Xtmpl_rewrite.html#VALenv_add_cb"><code class="code">Xtmpl_rewrite.env_add_cb</code></a> several times yourself.
<div class="vertical-space"> </div>

    <code class="code">env_of_list ~env:env [ (ns1, k1), f1 ; (ns2, k2), f2 ]</code> is equivalent to
    <code class="code">env_add_cb ~prefix: ns1 k1 f1 (env_add_cb ~prefix: ns2 k2 f2 env)</code>. This means that one key
    is present twice in the list, the first association in the list
    will hide the second one in the resulting environment.<br/>
</div>
<div class="param_info"><code class="code">env</code> : The environment to which bindings are added. If
    not provided, <a href="Xtmpl_rewrite.html#VALenv_empty"><code class="code">Xtmpl_rewrite.env_empty</code></a><code class="code"> ()</code> is used.</div>
<br/>
<div class="section-title" id="2_Errors">Errors</div><br/>

<pre><span id="TYPErewrite_stack"><span class="keyword">type</span> rewrite_stack</span> = <code class="type">(<a href="Xtmpl_rewrite.html#TYPEname">name</a> * <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list *<br/>        Xml.loc option)<br/>       list</code> </pre>
<div class="info ">
To catch eventual infinite loops in rewriting, we keep a
  stack of the rules called.<br/>
</div>


<pre><code><span id="TYPEerror"><span class="keyword">type</span> error</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTerror.Loop"><span class="constructor">Loop</span></span> <span class="keyword">of</span> <code class="type"><a href="Xtmpl_rewrite.html#TYPErewrite_stack">rewrite_stack</a></code></code></td>
<td class="typefieldcomment" align="left" valign="top" ><code>(*</code></td><td class="typefieldcomment" align="left" valign="top" ><div class="info ">
The <code class="code">Loop</code> error is raised when the rewrite stack
       is higher than a default value of <code class="code">100</code>. This value can be changed
       by setting the <code class="code">XTMPL_REWRITE_DEPTH_LIMIT</code> environment variable.<br/>
</div>
</td><td class="typefieldcomment" align="left" valign="bottom" ><code>*)</code></td>
</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTerror.Parse_error"><span class="constructor">Parse_error</span></span> <span class="keyword">of</span> <code class="type">Xml.loc * string</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTerror.Invalid_attribute_value"><span class="constructor">Invalid_attribute_value</span></span> <span class="keyword">of</span> <code class="type">string * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTerror.Fixpoint_limit"><span class="constructor">Fixpoint_limit</span></span> <span class="keyword">of</span> <code class="type">int</code></code></td>

</tr></table>



<pre><span id="EXCEPTIONError"><span class="keyword">exception</span> Error</span> <span class="keyword">of</span> <code class="type"><a href="Xtmpl_rewrite.html#TYPEerror">error</a></code></pre>

<pre><span id="VALloop_error"><span class="keyword">val</span> loop_error</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPErewrite_stack">rewrite_stack</a> -&gt; 'a</code></pre>
<pre><span id="VALparse_error"><span class="keyword">val</span> parse_error</span> : <code class="type">Xml.loc -&gt; string -&gt; 'a</code></pre>
<pre><span id="VALinvalid_attribute_value"><span class="keyword">val</span> invalid_attribute_value</span> : <code class="type">string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; 'a</code></pre>
<pre><span id="VALfixpoint_limit"><span class="keyword">val</span> fixpoint_limit</span> : <code class="type">int -&gt; 'a</code></pre>
<pre><span id="VALstring_of_error"><span class="keyword">val</span> string_of_error</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEerror">error</a> -&gt; string</code></pre>
<pre><span id="VALstring_of_rewrite_stack"><span class="keyword">val</span> string_of_rewrite_stack</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPErewrite_stack">rewrite_stack</a> -&gt; string</code></pre><div class="info ">
String representation of the given rewrite stack.<br/>
</div>
<br/>
<div class="section-title" id="2_Specialtagsandattributes">Special tags and attributes</div><br/>

<pre><span id="VALtag_env"><span class="keyword">val</span> tag_env</span> : <code class="type">string</code></pre><div class="info ">
The environment tag, currently <code class="code">"env_"</code>.
<div class="vertical-space"> </div>

    See the template rules in the <a href="Xtmpl_rewrite.html#engine"><i>Templating engine</i></a> section below for more
    information about this tag.<br/>
</div>

<pre><span id="VALatt_defer"><span class="keyword">val</span> att_defer</span> : <code class="type">string</code></pre><div class="info ">
The defer attribute, currently <code class="code">"defer_"</code>. See the engine section
  for details.<br/>
</div>

<pre><span id="VALatt_escamp"><span class="keyword">val</span> att_escamp</span> : <code class="type">string</code></pre><div class="info ">
The escamp attribute, currently <code class="code">"escamp_"</code>. This attribute
  is used when converting XML to string or reading XML from a string.
  The CDATA associated to this attribute indicates the other attributes
  in which the ampersands must be escaped (when parsing XML from an
  attribute string) or unescaped (when printing XML to an attribute string).
  This is useful for urls with &amp;, for example in <code class="code">&lt;a href="..."&gt;</code> nodes.
<div class="vertical-space"> </div>

  Example: In <code class="code">&lt;a escamp_="href", href="http://foo.fr?v1=3amp;v2=4"&gt;...&lt;/a&gt;</code>.
  As attributes are parsed as XML, setting the <code class="code">escamp_</code> attribute to <code class="code">"href"</code>
  will make the ampersand escaped. The attribute is kept during rewriting.
  When the XML tree will be converted to a string, the <code class="code">escamp_</code> attribute
  will be removed. Several attribute names can be indicated, using <code class="code">','</code>
  or <code class="code">';'</code> as separator, as in
  <code class="code"> &lt;a escamp_="href, foo, gee:buz" href="..." ...&gt;...&lt;/a&gt; </code>.<br/>
</div>

<pre><span id="VALatt_protect"><span class="keyword">val</span> att_protect</span> : <code class="type">string</code></pre><div class="info ">
The protect attribute, currently "protect_". See the engine section
  for details. This attribute is removed when a XML tree is converted
  to a string, as for <a href="Xtmpl_rewrite.html#VALatt_escamp"><code class="code">Xtmpl_rewrite.att_escamp</code></a>.<br/>
</div>
<br/>
<div class="section-title" id="2_Inputoutput">Input/output</div><br/>

<pre><span id="VALfrom_xml"><span class="keyword">val</span> from_xml</span> : <code class="type">Xml.tree -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre><div class="info ">
Convert from a <a href="Xtmpl_xml.html#TYPEtree"><code class="code">Xtmpl_xml.tree</code></a> list. Attribute values must
     be valid XML.<br/>
</div>

<pre><span id="VALfrom_xmls"><span class="keyword">val</span> from_xmls</span> : <code class="type">Xml.tree list -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALfrom_xml"><code class="code">Xtmpl_rewrite.from_xml</code></a> but for a list of trees.<br/>
</div>

<pre><span id="VALfrom_xml_atts"><span class="keyword">val</span> from_xml_atts</span> : <code class="type">Xml.str_attributes -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a></code></pre>
<pre><span id="VALfrom_doc"><span class="keyword">val</span> from_doc</span> : <code class="type">Xml.tree Xml.doc -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc</code></pre><div class="info ">
Convert from a <a href="Xtmpl_xml.html#VALdoc"><code class="code">Xtmpl_xml.doc</code></a>. Attribute values must be valid XML.<br/>
</div>

<pre><span id="VALto_xml"><span class="keyword">val</span> to_xml</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> -&gt; Xml.tree</code></pre><div class="info ">
Convert to a <a href="Xtmpl_xml.html#TYPEtree"><code class="code">Xtmpl_xml.tree</code></a>.<br/>
</div>
<div class="param_info"><code class="code">xml_atts</code> : indicates whether the code in attributes remains valid XML
    of not. Default is <code class="code">true</code> but it should be set to <code class="code">false</code> when outputting
    final documents like XHTML pages.</div>

<pre><span id="VALto_xmls"><span class="keyword">val</span> to_xmls</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; Xml.tree list</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALto_xml"><code class="code">Xtmpl_rewrite.to_xml</code></a> but for a list of trees.<br/>
</div>

<pre><span id="VALto_doc"><span class="keyword">val</span> to_doc</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc -&gt; Xml.tree Xml.doc</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALto_xml"><code class="code">Xtmpl_rewrite.to_xml</code></a> but for a doc.<br/>
</div>

<pre><span id="VALto_string"><span class="keyword">val</span> to_string</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; string</code></pre><div class="info ">
Output an XML string.<br/>
</div>
<div class="param_info"><code class="code">xml_atts</code> : see <a href="Xtmpl_rewrite.html#VALto_xml"><code class="code">Xtmpl_rewrite.to_xml</code></a>.</div>

<pre><span id="VALatts_to_string"><span class="keyword">val</span> atts_to_string</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEattributes">attributes</a> -&gt; Xml.str_attributes</code></pre>
<pre><span id="VALdoc_to_string"><span class="keyword">val</span> doc_to_string</span> : <code class="type">?xml_atts:bool -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc -&gt; string</code></pre><div class="info ">
Output an XML document.<br/>
</div>
<div class="param_info"><code class="code">xml_atts</code> : see <a href="Xtmpl_rewrite.html#VALto_xml"><code class="code">Xtmpl_rewrite.to_xml</code></a>.</div>

<pre><span id="VALfrom_string"><span class="keyword">val</span> from_string</span> : <code class="type">string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Parses a string as <a href="Xtmpl_rewrite.html#TYPEtree"><code class="code">Xtmpl_rewrite.tree</code></a> list.<br/>
</div>

<pre><span id="VALdoc_from_string"><span class="keyword">val</span> doc_from_string</span> : <code class="type">string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc</code></pre><div class="info ">
Parses a <a href="Xtmpl_rewrite.html#TYPEtree"><code class="code">Xtmpl_rewrite.tree</code></a> doc.<br/>
</div>

<pre><span id="VALfrom_file"><span class="keyword">val</span> from_file</span> : <code class="type">string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALfrom_string"><code class="code">Xtmpl_rewrite.from_string</code></a> but read from a file.<br/>
</div>

<pre><span id="VALdoc_from_file"><span class="keyword">val</span> doc_from_file</span> : <code class="type">string -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALdoc_from_string"><code class="code">Xtmpl_rewrite.doc_from_string</code></a> but read from a file.<br/>
</div>
<br/>
<div class="section-title" id="2_XMLManipulation">XML Manipulation</div><br/>

<pre><span id="VALmerge_cdata"><span class="keyword">val</span> merge_cdata</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEtree">tree</a> -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a></code></pre><div class="info ">
Recursively merge sibling <code class="code">D</code> nodes into one <code class="code">D</code> node.<br/>
</div>

<pre><span id="VALmerge_cdata_list"><span class="keyword">val</span> merge_cdata_list</span> : <code class="type"><a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Same as <a href="Xtmpl_rewrite.html#VALmerge_cdata"><code class="code">Xtmpl_rewrite.merge_cdata</code></a> but taking a <a href="Xtmpl_rewrite.html#TYPEtree"><code class="code">Xtmpl_rewrite.tree</code></a> list.<br/>
</div>
<br/>
<div class="section-title" id="engine">Templating engine</div>
<div class="vertical-space"> </div>

    The <code class="code">apply_*</code> functions apply a given environment and data to XML tree(s). These
    trees are given as parameter (<a href="Xtmpl_rewrite.html#VALapply_to_xmls"><code class="code">Xtmpl_rewrite.apply_to_xmls</code></a>) or can be read from a
    file (<a href="Xtmpl_rewrite.html#VALapply_to_file"><code class="code">Xtmpl_rewrite.apply_to_file</code></a>), or a string (<a href="Xtmpl_rewrite.html#VALapply_to_string"><code class="code">Xtmpl_rewrite.apply_to_string</code></a>).
<div class="vertical-space"> </div>

    The functions return the result of the rewrite as XML trees, or
    can write it to a file (<a href="Xtmpl_rewrite.html#VALapply_into_file"><code class="code">Xtmpl_rewrite.apply_into_file</code></a>). They also return data
    as the result of the callbacks called, as in a classic fold function (callbacks
    take the data in parameter, as the environment, the attributes and subnodes
    of the rewritten node).
<div class="vertical-space"> </div>

    The rewrite rules are applied until a fix-point is reached.
    If the <code class="code">XTMPL_FIXPOINT_LIMIT</code> environment variable contains a valid integer <code class="code">n</code>,
    it is used as a fix-point limit: if no fix-point is reached in <code class="code">n</code> iterations,
    then a <code class="code">Failure</code> exception is raised.
<div class="vertical-space"> </div>

<OL>
<li>A single iteration descends recursively into the XML tree. If an
    element has a callback associated in the environment, then the
    callback is applied to the current data and the node's attributes and children.
<div class="vertical-space"> </div>

    <i>Example</i>: consider the following XML:
<div class="vertical-space"> </div>

    <pre class="verbatim">&lt;album author="Rammstein" name="Reise, Reise"&gt;
  &lt;track&gt;Los&lt;/track&gt;
  &lt;track&gt;Mein Teil&lt;/track&gt;
&lt;/album&gt;</pre>
<div class="vertical-space"> </div>

    This would look for a callback bound to <code class="code">("","album")</code> in the environment
    and call it using
    <code class="code">callback data env {("","author")-&gt;[ D "Rammstein"]|("","name")-&gt;[D "Reise, Reise"]} xml</code>
    where <code class="code">env</code> is the current environment and <code class="code">xml</code> represents the
    two children <code class="code"> &lt;track&gt;..&lt;/track&gt; </code> elements.
</li>
<li>The callback returns a pair composed of (maybe new) data
     and a new list of elements that is used instead of the old element.
<div class="vertical-space"> </div>

    <i>Example</i>: assuming that the environnement was build using
    <code class="code">env_add_cb "x2" (fun data _ _ xml -&gt; (data, xml @ xml)) env</code>,
    then <code class="code">&lt;x2&gt;A&lt;/x2&gt;</code> is rewritten as <code class="code">AA</code>.
</li>
<li>The engine then recursively descends into those replaced
    elements (this means that a poorly conceived rule set may well never
    terminate).
<div class="vertical-space"> </div>

    <i>Example</i>: <code class="code">&lt;x2&gt;&lt;x2&gt;A&lt;/x2&gt;&lt;/x2&gt;</code> is first rewritten as
    <code class="code">&lt;x2&gt;A&lt;/x2&gt;&lt;x2&gt;A&lt;/x2&gt;</code>, and then as <code class="code">AAAA</code>.
</li>
<li> The <code class="code">env_</code> element (see <a href="Xtmpl_rewrite.html#VALtag_env"><code class="code">Xtmpl_rewrite.tag_env</code></a> is a special case: it is automatically
    replaced with its children (as if its callback was <code class="code">(fun data _ _ xml -&gt; (data, xml))</code>).
<div class="vertical-space"> </div>

    <code class="code">env_</code> effectively changes the environment
    used when processing its children by adding the bindings defined by
    its attributes (using <a href="Xtmpl_rewrite.html#VALenv_add_xml"><code class="code">Xtmpl_rewrite.env_add_xml</code></a>).
<div class="vertical-space"> </div>

    <i>Example</i>: <code class="code">&lt;env_ a="&amp;lt;b&amp;gt;A&amp;lt;/b&amp;gt;"&gt;&lt;a/&gt;&lt;/env_&gt;</code> is
    replaced by <code class="code">&lt;a/&gt;</code>, which in turn is replaced by
    <code class="code">&lt;b&gt;A&lt;/b&gt;</code>.
</li>
<li>If an element has a <code class="code">defer_</code> attribute (that is greater
    than zero), then it is not processed and the attribute is decremented
    by one, and the process recursively applies to its children.
<div class="vertical-space"> </div>

    <i>Example</i>: <code class="code">&lt;x2 defer_="1"&gt;&lt;x2&gt;A&lt;/x2&gt;&lt;/x2&gt;</code> is rewritten as
    <code class="code">&lt;x2 defer_="0"&gt;AA&lt;/x2&gt;</code>. The <b>next</b> iteration will effectively apply the
    rule to the node and return <code class="code">AAAA</code>.
</li>
<li> If an element has a <code class="code">protect_</code> attribute, then the value
    must be CDATA and contains a list of names to remove from the environment
    when descending in the children. The names are separated by <code class="code">','</code> or <code class="code">';'</code>,
    for example: <code class="code">&lt;foo protect_="title,id,foo:bar" ..&gt;...&lt;/foo&gt;</code>.
</li>
</OL>
<br/>

<pre><span id="VALapply_to_string"><span class="keyword">val</span> apply_to_string</span> : <code class="type">'a -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; string -&gt; 'a * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
Applies as many iterations as necessary to a piece of XML (represented
    as an unparsed string) to reach a fix-point.
<div class="vertical-space"> </div>

    See above for how an iteration is applied.<br/>
</div>

<pre><span id="VALapply_to_file"><span class="keyword">val</span> apply_to_file</span> : <code class="type">'a -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; string -&gt; 'a * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
As <a href="Xtmpl_rewrite.html#VALapply_to_string"><code class="code">Xtmpl_rewrite.apply_to_string</code></a>, but reads the XML from a file.<br/>
</div>

<pre><span id="VALapply_to_xmls"><span class="keyword">val</span> apply_to_xmls</span> : <code class="type">'a -&gt;<br/>       'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list -&gt; 'a * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> list</code></pre><div class="info ">
As <a href="Xtmpl_rewrite.html#VALapply_to_string"><code class="code">Xtmpl_rewrite.apply_to_string</code></a>, but applies to a list of XML trees.<br/>
</div>

<pre><span id="VALapply_to_doc"><span class="keyword">val</span> apply_to_doc</span> : <code class="type">'a -&gt;<br/>       'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt;<br/>       <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc -&gt; 'a * <a href="Xtmpl_rewrite.html#TYPEtree">tree</a> Xml.doc</code></pre><div class="info ">
As <a href="Xtmpl_rewrite.html#VALapply_to_string"><code class="code">Xtmpl_rewrite.apply_to_string</code></a>, but applies to a doc.<br/>
</div>

<pre><span id="VALapply_into_file"><span class="keyword">val</span> apply_into_file</span> : <code class="type">'a -&gt;<br/>       ?head:string -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; infile:string -&gt; outfile:string -&gt; 'a</code></pre><div class="info ">
As <a href="Xtmpl_rewrite.html#VALapply_to_file"><code class="code">Xtmpl_rewrite.apply_to_file</code></a>, but writes the result back to a file.
<div class="vertical-space"> </div>

    For instance, <code class="code">apply_to_file data env ~infile:"source.xml" ~outfile: "dest.xml"</code>.<br/>
</div>
<div class="param_info"><code class="code">head</code> : Prepend this string to the XML that is output
    to the file. By default, nothing is prepended.</div>

<pre><span id="VALapply_string_into_file"><span class="keyword">val</span> apply_string_into_file</span> : <code class="type">'a -&gt; ?head:string -&gt; 'a <a href="Xtmpl_rewrite.html#TYPEenv">env</a> -&gt; outfile:string -&gt; string -&gt; 'a</code></pre><div class="info ">
As <a href="Xtmpl_rewrite.html#VALapply_into_file"><code class="code">Xtmpl_rewrite.apply_into_file</code></a>, but read the XML from a string instead of a file.<br/>
</div>
</div></contents></ocamldoc>